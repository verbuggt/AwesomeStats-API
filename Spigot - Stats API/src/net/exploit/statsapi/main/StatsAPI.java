package net.exploit.statsapi.main;

import org.bukkit.Bukkit;
import org.bukkit.plugin.java.JavaPlugin;

import net.exploit.statsapi.listener.PlayerLoginListener;
import net.exploit.statsapi.manager.LoginInfoManager;
import net.exploit.statsapi.mysql.MySQL;

public class StatsAPI extends JavaPlugin {

	private static StatsAPI api;
	private MySQL mysql;

	public LoginInfoManager loginInfo;

	@Override
	public void onEnable() {
		StatsAPI.api = this;

		this.loginInfo = new LoginInfoManager("mysql", "AwesomeStats API");
		this.mysql = new MySQL(this);

		this.mysql.updateSynchronously("CREATE TABLE IF NOT EXISTS users(uuid varchar(36) PRIMARY KEY, name varchar(16))");
		this.mysql.updateSynchronously("CREATE TABLE IF NOT EXISTS coins(uuid varchar(36), coins LONG, FOREIGN KEY (uuid) REFERENCES users(uuid));");
		registerEvents();
	}

	private void registerEvents() {
		Bukkit.getPluginManager().registerEvents(new PlayerLoginListener(), this);
	}

	@Override
	public void onDisable() {
		mysql.disconnect();
	}

	public static StatsAPI getApi() {
		return api;
	}

	public MySQL getMySQL() {
		return this.mysql;
	}
}

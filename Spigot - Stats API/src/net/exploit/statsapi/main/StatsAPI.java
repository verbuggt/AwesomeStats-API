package net.exploit.statsapi.main;

import org.bukkit.Bukkit;
import org.bukkit.plugin.java.JavaPlugin;

import net.exploit.statsapi.listener.PlayerLoginListener;
import net.exploit.statsapi.manager.LoginInfoManager;
import net.exploit.statsapi.mysql.MySQL;
import net.exploit.statsapi.stats.StatsHelper;
import net.exploit.statsapi.stats.VT;
import net.exploit.statsapi.stats.Value;
import net.exploit.statsapi.user.NameCacheUtil;

public class StatsAPI extends JavaPlugin {

	private static StatsAPI api;
	private MySQL mysql;

	public LoginInfoManager loginInfo;

	@Override
	public void onEnable() {
		StatsAPI.api = this;

		this.loginInfo = new LoginInfoManager("mysql", "AwesomeStats API");
		this.mysql = new MySQL(this);

		this.mysql.updateSynchronously("CREATE TABLE IF NOT EXISTS users(uuid varchar(36) PRIMARY KEY, name varchar(16))");
		this.mysql.updateSynchronously("CREATE TABLE IF NOT EXISTS coins(uuid varchar(36), coins LONG, FOREIGN KEY (uuid) REFERENCES users(uuid));");

		// DEBUG - This is how the API should be used in other Plugins
		StatsHelper s = new StatsHelper("ffa", new Value[] { new Value("kills", VT.LONG), new Value("deaths", VT.LONG) }, true);
		s.set("kills", NameCacheUtil.getUUIDByName("verbuqqt"), 7);
		s.set("deaths", NameCacheUtil.getUUIDByName("verbuqqt"), 0);
		s.set("points", NameCacheUtil.getUUIDByName("verbuqqt"), 10);
		s.setCoins(NameCacheUtil.getUUIDByName("verbuqqt"), 100);
		System.out.println(s.getCoins(NameCacheUtil.getUUIDByName("verbuqqt")));
		System.out.println(s.get("kills", NameCacheUtil.getUUIDByName("verbuqqt")));
		registerEvents();
	}

	private void registerEvents() {
		Bukkit.getPluginManager().registerEvents(new PlayerLoginListener(), this);
	}

	@Override
	public void onDisable() {
		mysql.disconnect();
	}

	public static StatsAPI getApi() {
		return api;
	}

	public MySQL getMySQL() {
		return this.mysql;
	}
}
